//TODO move the main search loop here